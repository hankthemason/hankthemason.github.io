<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.457b234fb14c4e7d6482.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.gatsby-highlight{margin-top:1rem}.gatsby-highlight .token{background-color:#f5f2f0}.project-module--project-box--3d_dN{border:1px solid #000;border-radius:10px;margin:2rem;width:80%}.project-module--title--2ReKs{color:#000;font-size:2rem;font-weight:200;margin:.1rem}.project-module--project-content--aX6w1{border-radius:10px;display:flex;justify-content:space-between;padding:1rem}.project-module--project-text--yCIz3{display:flex;flex-direction:column;width:50%}.project-module--project-image--1_SNr{align-items:center;display:flex;height:10rem;justify-content:center;margin-top:.8rem;width:50%;width:15rem}.project-module--project-content--aX6w1,.project-module--project-content--aX6w1 *{background-color:#99bde6}.project-module--description--2V9T3{color:#000}.project-module--github-logo--2ZLW_{align-items:center;display:flex;height:1.7rem;margin-top:.6rem;width:100%}@media only screen and (max-width:400px){.project-module--project-content--aX6w1{border-radius:10px;display:flex;flex-direction:column;justify-content:space-between;padding:1rem}.project-module--project-text--yCIz3{width:100%}.project-module--project-image--1_SNr{justify-content:flex-start;width:100%}.project-module--title--2ReKs{font-size:1.5rem}}.projects-module--projects--ttLou{align-items:center;display:flex;flex-direction:column}.projects-module--headline--eZADs{font-size:3rem;font-weight:200;margin:0;text-align:center}.projects-module--headline--eZADs p{margin:1.6rem 1rem 1rem}@media only screen and (max-width:400px){.projects-module--headline--eZADs p{font-size:2.4rem;margin-top:1.6rem}}.postTemplate-module--post-body--1dpdj{margin:0 auto;width:80%}.postTemplate-module--post-title--1mgEd{font-size:3rem;font-weight:400;line-height:3rem;margin-top:1.6rem}.postTemplate-module--post-date--1dC_s{font-style:italic}.postTemplate-module--post-body--1dpdj{font-size:1.5rem;line-height:2.2rem}.postTemplate-module--post-body--1dpdj .postTemplate-module--gatsby-highlight--2EeGk{margin-top:5rem}.postTemplate-module--return-link--3C5yc{font-size:1.2rem}.postTemplate-module--console--xmhZD{width:50%}.postTemplate-module--post-body--1dpdj a{overflow-wrap:break-word}@media only screen and (max-width:600px){.postTemplate-module--return-link--3C5yc{font-size:1rem}.postTemplate-module--post-title--1mgEd{line-height:3rem}.postTemplate-module--post-body--1dpdj{font-size:1rem;line-height:1.2rem}.postTemplate-module--console--xmhZD{width:100%}}.header-module--container--3lNyw{align-items:flex-end;display:flex;justify-content:space-between}.header-module--name--307Om{color:#093e77;font-size:4rem;font-weight:300;margin:0;padding:0}.header-module--name-link--1vEKt a{text-decoration:none}.header-module--name-link--1vEKt:hover{opacity:.7}.header-module--nav-links--3bWTn{display:flex;font-size:2.2rem;font-weight:200;list-style:none;margin:0}.header-module--nav-link-item--1Q7k4{padding-right:2rem}.header-module--nav-link-item--1Q7k4:hover{opacity:.7}.header-module--line--2I-Jv{border:1px solid grey}@media only screen and (max-width:760px){.header-module--container--3lNyw{align-items:center;display:flex;flex-direction:column}.header-module--nav-links--3bWTn{font-size:1.2rem}}*{background-color:#adcaeb;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.about-module--bio--1vKOY{display:flex;justify-content:center;padding-top:3rem}.about-module--pic--3i4Cf{display:flex;flex-direction:column;height:800px;width:400px}.about-module--bio-body--2kN5w{font-size:1.4rem;padding-left:3rem;width:40%}.about-module--links--2uJud{display:flex;flex-direction:column}.about-module--row--1Uqt1{display:flex;font-size:1.5rem;height:1.5rem;margin:.45rem;width:30%}.about-module--logo--3MUUa{margin-left:.3rem;padding-top:.1rem}.about-module--links-mobile--2zBIB{display:none}@media only screen and (max-width:650px){.about-module--bio--1vKOY{align-items:center;display:flex;flex-direction:column}.about-module--pic--3i4Cf{height:140px;width:200px}.about-module--bio-body--2kN5w{font-size:1.2rem;width:80%}.about-module--links--2uJud{display:none}.about-module--links-mobile--2zBIB{display:flex;flex-direction:column}.about-module--row--1Uqt1{font-size:1rem}}.blog-module--headline--1EsHJ{font-size:3rem;font-weight:200;margin:1.6rem 1rem 1rem;text-align:center}.post-module--post--1JdYe{border:1px solid grey;margin:0 4rem 4rem;padding:2rem 1rem}.post-module--post-title--3iro9{font-size:2rem;font-weight:300}.post-module--post-description--2ADf6{font-size:1.1rem;font-weight:100;padding:.5rem 0 2rem}.post-module--post-description--2ADf6 p{margin:.4rem 0}.post-module--post-date--27hmA{font-style:italic}.post-module--post--1JdYe a{background-color:#99bde6;border:1px solid grey;font-size:1.3rem;padding:.6rem;text-decoration:none}@media only screen and (max-width:400px){.post-module--post--1JdYe{margin:0 0 2rem}}</style><meta name="generator" content="Gatsby 3.7.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=769b1ae0a35025303f145fad38af2254" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=769b1ae0a35025303f145fad38af2254"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=769b1ae0a35025303f145fad38af2254"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=769b1ae0a35025303f145fad38af2254"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=769b1ae0a35025303f145fad38af2254"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=769b1ae0a35025303f145fad38af2254"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=769b1ae0a35025303f145fad38af2254"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=769b1ae0a35025303f145fad38af2254"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=769b1ae0a35025303f145fad38af2254"/><link as="script" rel="preload" href="/webpack-runtime-6d360eab93763492fd4a.js"/><link as="script" rel="preload" href="/framework-922e6c69dba211002120.js"/><link as="script" rel="preload" href="/app-7b50eb4357f48bb680ea.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-16e1a8ec52e56913d6c5.js"/><link as="fetch" rel="preload" href="/page-data/blog/d3_maps_pt2/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="header-module--container--3lNyw"><div class="header-module--name-link--1vEKt"><a style="text-decoration:none" href="/"><h1 class="header-module--name--307Om">Hank Mason</h1></a></div><div class="header-module--nav-links--3bWTn"><ul class="header-module--nav-links--3bWTn"><li class="header-module--nav-link-item--1Q7k4"><a href="/about">About Me</a></li><li class="header-module--nav-link-item--1Q7k4"><a href="/projects">My Projects</a></li><li class="header-module--nav-link-item--1Q7k4"><a href="/blog">Blog</a></li></ul></div></div><hr class="header-module--line--2I-Jv"/><div class="postTemplate-module--post-body--1dpdj"><div class="postTemplate-module--return-link--3C5yc"><a href="/blog">Back to blog home</a></div><div class="postTemplate-module--post-title--1mgEd">Build a map of NYPD precincts with React &amp; D3, Part 2</div><p class="postTemplate-module--post-date--1dC_s">Posted on <!-- -->2021-06-25</p><div><p>In Part 2 of this tutorial, we are going to turn our basic map into a heat map that visualizes the amount of total allegations filed against each precinct. If you missed <a href="http://hankthemason.github.io/blog/d3_maps_pt1">Part 1</a>, I recommend reading that first.</p>
<p>Now that we have a basic working map, let’s use it to show some data! The data we are going to be using comes from <a href="https://projects.propublica.org/nypd-ccrb/">ProPublica’s</a> release of over 33,300 records of misconduct against the NYPD, dating back to 1985. The actual data parsing is outside the scope of this article — instead, we’ll be using a .json file that I made from the data and can be downloaded in this project’s <a href="https://github.com/hankthemason/nyc-precinct-map-tutorial-pt2/tree/main/src/data">GitHub repo</a>.</p>
<p>First let’s work on adding to our <code class="language-text">App</code> component, since that is where we pass down props to our <code class="language-text">Map</code> component, and we’ll need to pass it some new data. We can import the .json file at the top of our file with the following line of code:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> allegationsPerPrecinct <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./data/allegationsByPrecinct.json'</span></code></pre></div>
<p>Then we’ll update how we render <code class="language-text">Map</code> component, by passing it the <code class="language-text">allegationsPerPrecinct</code> object we just imported as a new prop.<br>
<br></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Map geoJson<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span> allegationsPerPrecinct<span class="token operator">=</span><span class="token punctuation">{</span>allegationsPerPrecinct<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<br>
Here’s what the finished App component looks like:<br>
<br>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Map'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> allegationsPerPrecinct <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./data/allegationsByPrecinct.json'</span>

<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://opendata.arcgis.com/datasets/c35786feb0ac4d1b964f41f874f151c1_0.geojson'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token function">setData</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Map geoJson<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span> allegationsPerPrecinct<span class="token operator">=</span><span class="token punctuation">{</span>allegationsPerPrecinct<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p>Now we need to update our <code class="language-text">Map</code> component in order to read the data and reflect it in our map. In our new heat map, we will be representing the amount of allegations associated with each precinct through a spectrum of colors. The more allegations a precinct has, the darker it will appear on the map. To do this, we need a <strong>scale</strong> function: a function that takes in a value in our input <strong>domain</strong> and returns a ‘scaled’ value within our output <strong>range</strong>. Once again, D3 provides a number of functions we can use, all of which have specific use cases. We will be using <code class="language-text">scaleSequential()</code>, which is a good choice for generating color scales. We will be giving it two arguments: the input <strong>domain</strong>, and an interpolator that it will use to generate output in the form of an RGB value.</p>
<p>Let’s cover the input first. For our purposes, the <strong>domain</strong> will be all the possible numbers of allegations that a precinct can have, so it will include all numbers from 0 to the maximum amount of allegations that any precinct has. In order to get this value, we’ll use the <code class="language-text">map()</code> iterator and ES6’s spread operator :</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> maxAllegations <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span>allegations<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=></span> obj<span class="token punctuation">.</span>allegations<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Now we can write our scale function. For its second argument, we’ll be using one of D3’s built-in interpolators, <code class="language-text">interpolateBlues</code>, to generate RGB values in a spectrum of blue colors. The completed function will look like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> scale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleSequential</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> maxAllegations<span class="token punctuation">]</span><span class="token punctuation">,</span> d3<span class="token punctuation">.</span>interpolateBlues<span class="token punctuation">)</span></code></pre></div>
<p>The next part is a lot of fun, and is a great example of D3’s data-driven philosophy at work. In the earlier iteration of <code class="language-text">Map</code>, our <code class="language-text">renderMap()</code> function gave each path element a ‘fill’ attribute with the value of ‘transparent’. Obviously we need to change that if we want color, and D3 gives us a powerful way to do that dynamically. This time, each element's <strong>‘fill’</strong> attribute will be given a function instead of a string value, and inside that function we will generate a color for each <code class="language-text">&lt;path&gt;</code> element. Remember, each of these elements corresponds to a precinct, so we can use the number of allegations associated with that precinct along with our previously-defined scale function to get the correct value for ‘fill’. Here’s what that part of the code will look like:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> precinct <span class="token operator">=</span> allegationsPerPrecinct<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> item<span class="token punctuation">.</span>precinct <span class="token operator">===</span> d<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string">'Precinct'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">scale</span><span class="token punctuation">(</span>precinct<span class="token punctuation">.</span>allegations<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>We are using D3 to iterate over the features of our GeoJSON object and "draw" the path string for each feature, which corresponds to a precinct. For the <strong>'fill'</strong> attribute, we’ll access the current feature’s <strong>‘Precinct’</strong> property in order to filter our <code class="language-text">allegationsPerPrecinct</code> array and find the corresponding precinct. Then we just pass the precinct's <strong>‘allegations’</strong> property into <code class="language-text">scale()</code>, and it will return an RGB value. Reload your browser and look at the results. You should be rendering a colorized heat map now! Here’s what the finished Map component will look like:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> d3 <span class="token keyword">from</span> <span class="token string">'d3'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Map</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> geoJson<span class="token punctuation">,</span> allegationsPerPrecinct <span class="token punctuation">}</span> <span class="token operator">=</span> props
  
  <span class="token keyword">const</span> maxAllegations <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span>allegationsPerPrecinct<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=></span> obj<span class="token punctuation">.</span>allegations<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> scale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleSequential</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> maxAllegations<span class="token punctuation">]</span><span class="token punctuation">,</span> d3<span class="token punctuation">.</span>interpolateBlues<span class="token punctuation">)</span>

  <span class="token keyword">const</span> svgRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">renderMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">mapData<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>svgRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>mapData<span class="token punctuation">.</span>features<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">precinct-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string">'Precinct'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke'</span><span class="token punctuation">,</span> <span class="token string">'#000000'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke-width'</span><span class="token punctuation">,</span> <span class="token string">'.2'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> precinct <span class="token operator">=</span> allegationsPerPrecinct<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> item<span class="token punctuation">.</span>precinct <span class="token operator">===</span> d<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string">'Precinct'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token function">scale</span><span class="token punctuation">(</span>precinct<span class="token punctuation">.</span>allegations<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> height <span class="token operator">=</span> svgRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>clientHeight
    <span class="token keyword">const</span> width <span class="token operator">=</span> svgRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>clientWidth

    <span class="token keyword">const</span> projection <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">geoAlbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fitSize</span><span class="token punctuation">(</span><span class="token punctuation">[</span>height<span class="token punctuation">,</span> width<span class="token punctuation">]</span><span class="token punctuation">,</span> geoJson<span class="token punctuation">)</span>

	  <span class="token keyword">const</span> pathGenerator <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">geoPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>geoJson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">renderMap</span><span class="token punctuation">(</span>geoJson<span class="token punctuation">,</span> pathGenerator<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>geoJson<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'wrapper'</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>svg 
        className<span class="token operator">=</span><span class="token string">'precincts-map'</span> 
        ref<span class="token operator">=</span><span class="token punctuation">{</span>svgRef<span class="token punctuation">}</span> 
        height<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">}</span> 
        width<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">}</span>
        style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>marginTop<span class="token operator">:</span> <span class="token string">'2em'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And here’s the colorized heat map!</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 877px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b3d56b35a0a48328d4323895e222efce/4b446/colorized_heat_map.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 77.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVQoz42SS0vDQBDH+/38RJ48+RUEBY9iD0JBCsUXKBQEK1hK25jaNjVJs2m2u802fWSTnYlY8WDT2J3DHIb5zfznUcqKLYhiaxoBQFFCKR/CjU9SVX61LhujgAlERF14k9mfhEfXb3ddj4XRb0FtuO1MTx6NjktdthBLGScq3760syQiDjzetKjp8p4vPL5+9+aJAi04lqnpBEMys3nssNWD4dc/aJZTv3thSkF/TCtN+/D89qLWqHZJtTXO9GV7k9nZ8/Dg+Oq0fG8QXu95AP/CmGWgoOuHbRISvngy/ZcBZeEimPJPKvbMrAA6rqg03RvDn6+k4c5GPmdimce24R9NJpm3bMEiiYgyVQoANqMi7rj1dmcSSptGSaoyDfsDr6ViUVLwi/vgb23aZOGpNOEv6/Vn8lIDrq0AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="colorized head map of nypd precincts"
        title="colorized head map of nypd precincts"
        src="/static/b3d56b35a0a48328d4323895e222efce/4b446/colorized_heat_map.png"
        srcset="/static/b3d56b35a0a48328d4323895e222efce/0b533/colorized_heat_map.png 500w,
/static/b3d56b35a0a48328d4323895e222efce/4b446/colorized_heat_map.png 877w"
        sizes="(max-width: 877px) 100vw, 877px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>Congratulations! You know have a working heat map of NYC's police precincts!
If you have any questions, feel free to contact me.  Thanks for reading, and happy coding.</p>
<p>You can look at the original code and download it here: <a href="https://github.com/hankthemason/nyc-precinct-map-tutorial-pt2">https://github.com/hankthemason/nyc-precinct-map-tutorial-pt2</a></p></div><div class="postTemplate-module--return-link--3C5yc" style="margin-bottom:3rem"><a href="/blog">Back to blog home</a></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/d3_maps_pt2";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2a1c0a52cb0b7a0205e1.js"],"app":["/app-7b50eb4357f48bb680ea.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0e53b41ea18b14228e9a.js"],"component---src-pages-about-js":["/component---src-pages-about-js-14fbbee8985cc5d1f3b3.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-1252a94405f6086bc4ea.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c1d7c8894708de6eddd0.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-a164c4de850ca0528979.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-16e1a8ec52e56913d6c5.js"]};/*]]>*/</script><script src="/polyfill-2a1c0a52cb0b7a0205e1.js" nomodule=""></script><script src="/component---src-templates-post-template-js-16e1a8ec52e56913d6c5.js" async=""></script><script src="/app-7b50eb4357f48bb680ea.js" async=""></script><script src="/framework-922e6c69dba211002120.js" async=""></script><script src="/webpack-runtime-6d360eab93763492fd4a.js" async=""></script></body></html>